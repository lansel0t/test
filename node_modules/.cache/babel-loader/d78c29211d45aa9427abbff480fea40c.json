{"ast":null,"code":"import { isNullOrUndefined, extend, addClass, removeClass } from '@syncfusion/ej2-base';\nimport { EventTooltip } from '../popups/event-tooltip';\nimport * as events from '../base/constant';\nimport * as cls from '../base/css-constant';\nimport { VirtualScroll } from '../actions/virtual-scroll';\n/**\n * Schedule DOM rendering\n */\n\nvar Render =\n/** @class */\nfunction () {\n  /**\n   * Constructor for render\n   */\n  function Render(parent) {\n    this.parent = parent;\n  }\n\n  Render.prototype.render = function (viewName, isDataRefresh) {\n    if (isDataRefresh === void 0) {\n      isDataRefresh = true;\n    }\n\n    this.initializeLayout(viewName);\n\n    if (isDataRefresh) {\n      this.refreshDataManager();\n    }\n  };\n\n  Render.prototype.initializeLayout = function (viewName) {\n    if (this.parent.activeView) {\n      this.parent.resetLayoutTemplates();\n      this.parent.resetEventTemplates();\n      this.parent.activeView.removeEventListener();\n      this.parent.activeView.destroy();\n    }\n\n    switch (viewName) {\n      case 'Day':\n        this.parent.activeView = this.parent.dayModule;\n        break;\n\n      case 'Week':\n        this.parent.activeView = this.parent.weekModule;\n        break;\n\n      case 'WorkWeek':\n        this.parent.activeView = this.parent.workWeekModule;\n        break;\n\n      case 'Month':\n        this.parent.activeView = this.parent.monthModule;\n        break;\n      // case 'Year':\n      //     this.parent.activeView = this.parent.yearModule;\n      //     break;\n\n      case 'Agenda':\n        this.parent.activeView = this.parent.agendaModule;\n        break;\n\n      case 'MonthAgenda':\n        this.parent.activeView = this.parent.monthAgendaModule;\n        break;\n\n      case 'TimelineDay':\n        this.parent.activeView = this.parent.timelineViewsModule;\n        this.parent.activeView.viewClass = 'e-timeline-day-view';\n        break;\n\n      case 'TimelineWorkWeek':\n        this.parent.activeView = this.parent.timelineViewsModule;\n        this.parent.activeView.viewClass = 'e-timeline-work-week-view';\n        break;\n\n      case 'TimelineWeek':\n        this.parent.activeView = this.parent.timelineViewsModule;\n        this.parent.activeView.viewClass = 'e-timeline-week-view';\n        break;\n\n      case 'TimelineMonth':\n        this.parent.activeView = this.parent.timelineMonthModule;\n        break;\n\n      case 'TimelineYear':\n        this.parent.activeView = this.parent.timelineYearModule;\n        break;\n    }\n\n    if (isNullOrUndefined(this.parent.activeView)) {\n      var firstView = this.parent.viewCollections[0].option;\n\n      if (firstView) {\n        this.parent.setProperties({\n          currentView: firstView\n        }, true);\n\n        if (this.parent.headerModule) {\n          this.parent.headerModule.updateActiveView();\n          this.parent.headerModule.setCalendarView();\n        }\n\n        return this.initializeLayout(firstView);\n      }\n\n      throw Error('Inject required modules');\n    }\n\n    this.updateLabelText(viewName);\n    this.parent.activeView.addEventListener();\n    this.parent.activeView.getRenderDates();\n    this.parent.uiStateValues.isGroupAdaptive = this.parent.isAdaptive && this.parent.activeViewOptions.group.resources.length > 0 && this.parent.activeViewOptions.group.enableCompactView;\n\n    if (this.parent.virtualScrollModule) {\n      this.parent.virtualScrollModule.destroy();\n      this.parent.virtualScrollModule = null;\n    }\n\n    if (this.parent.currentView.indexOf('Timeline') !== -1 && this.parent.activeViewOptions.allowVirtualScrolling && this.parent.activeViewOptions.group.resources.length > 0 && !this.parent.uiStateValues.isGroupAdaptive) {\n      this.parent.virtualScrollModule = new VirtualScroll(this.parent);\n      this.parent.uiStateValues.top = 0;\n    }\n\n    if (this.parent.headerModule) {\n      this.parent.headerModule.setDayOfWeek(this.parent.activeViewOptions.firstDayOfWeek);\n\n      if (this.parent.activeViewOptions.readonly) {\n        addClass([this.parent.element], cls.READ_ONLY);\n      } else if (this.parent.element.classList.contains(cls.READ_ONLY)) {\n        removeClass([this.parent.element], cls.READ_ONLY);\n      }\n\n      this.parent.headerModule.updateDateRange(this.parent.activeView.getDateRangeText());\n      this.parent.headerModule.updateHeaderItems('remove');\n    }\n\n    this.parent.activeView.renderLayout(cls.CURRENT_PANEL_CLASS);\n\n    if (this.parent.eventTooltip) {\n      this.parent.eventTooltip.destroy();\n      this.parent.eventTooltip = null;\n    }\n\n    if (this.parent.eventSettings.enableTooltip || this.parent.activeViewOptions.group.resources.length > 0 && this.parent.activeViewOptions.group.headerTooltipTemplate) {\n      this.parent.eventTooltip = new EventTooltip(this.parent);\n    }\n  };\n\n  Render.prototype.updateLabelText = function (view) {\n    var content = this.parent.activeView.getLabelText(view);\n    this.parent.element.setAttribute('role', 'main');\n    this.parent.element.setAttribute('aria-label', content);\n  };\n\n  Render.prototype.refreshDataManager = function () {\n    var _this = this;\n\n    var start = this.parent.activeView.startDate();\n    var end = this.parent.activeView.endDate();\n    var dataManager = this.parent.dataModule.getData(this.parent.dataModule.generateQuery(start, end));\n    dataManager.then(function (e) {\n      return _this.dataManagerSuccess(e);\n    }).catch(function (e) {\n      return _this.dataManagerFailure(e);\n    });\n  };\n\n  Render.prototype.dataManagerSuccess = function (e) {\n    var _this = this;\n\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.trigger(events.dataBinding, e, function (args) {\n      var resultData = extend([], args.result, null, true);\n      _this.parent.eventsData = resultData.filter(function (data) {\n        return !data[_this.parent.eventFields.isBlock];\n      });\n      _this.parent.blockData = resultData.filter(function (data) {\n        return data[_this.parent.eventFields.isBlock];\n      });\n\n      var processed = _this.parent.eventBase.processData(resultData);\n\n      _this.parent.notify(events.dataReady, {\n        processedData: processed\n      });\n\n      if (_this.parent.dragAndDropModule && _this.parent.dragAndDropModule.actionObj.action === 'drag') {\n        _this.parent.dragAndDropModule.navigationWrapper();\n      }\n\n      _this.parent.renderCompleted();\n\n      _this.parent.trigger(events.dataBound, null, function () {\n        return _this.parent.hideSpinner();\n      });\n    });\n  };\n\n  Render.prototype.dataManagerFailure = function (e) {\n    var _this = this;\n\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.trigger(events.actionFailure, {\n      error: e\n    }, function () {\n      return _this.parent.hideSpinner();\n    });\n  };\n\n  return Render;\n}();\n\nexport { Render };","map":null,"metadata":{},"sourceType":"module"}